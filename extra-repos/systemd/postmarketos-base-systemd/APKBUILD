# Maintainer: Oliver Smith <ollipearanoid@postmarketos.org>
# pmbootstrap installs this, if systemd is selected in "pmbootstrap init".
pkgname=postmarketos-base-systemd
pkgver=8
pkgrel=0
pkgdesc="Meta package for running postmarketOS with systemd"
url="https://postmarketos.org"
arch="noarch"
license="GPL-3.0-or-later"
options="!check"
depends="
	openssh-server-pam
	polkit
	systemd
	systemd-timesyncd
	tzdata
	linux-pam=1.6.1-r1
	systemd-services
	"
replaces="alpine-baselayout postmarketos-base systemd systemd-logind"
replaces_priority=100

_source644="
	etc/motd.ansi
	etc/profile.d/99motd.sh
	etc/systemd/logind.conf
	etc/ssh/sshd_config.d/usepam.conf
	usr/share/mkinitfs/files/01-initramfs-base-systemd.files
	usr/lib/systemd/system-preset/90-base.preset
	usr/lib/systemd/user-preset/90-base.preset
"

_source755="
	usr/bin/setup-timezone
"

flatpath() {
	local i
	for i in $@; do
		echo "rootfs-$i" | sed s./.-.g
	done
}
source="$(flatpath $_source644 $_source755)"

package() {
	local i
	for i in $_source644; do
		install -Dm644 "$srcdir/$(flatpath "$i")" "$pkgdir/$i"
	done
	for i in $_source755; do
		install -Dm755 "$srcdir/$(flatpath "$i")" "$pkgdir/$i"
	done

	# This gets printed still so overwrite it with an empty file.
	touch $pkgdir/etc/motd
}

sha512sums="
a6c27ab5d365807a40b16328918b6ca3d7f97a4128381674001cf46133928d8bb073ff4691b78c82f7965bcc2649d7ca4bf3e7453dd61be9b9341bbe6b448fd6  rootfs-etc-motd.ansi
fbaa33425e507062a454f11bda48508f261c2144e5c23a20f567dc1cef14ce1dec57f8d934f418f5b6095509757f8503481aba9790a04c8f9f6995e65833d8c9  rootfs-etc-profile.d-99motd.sh
2faac294bb632762e247b850f09ff4b544ccff6c462efd8d4faca71ba30bdfa9c460377a0dc88e92c5dbbe251017d164064a56ac0e0410f224b45d4f5f81866c  rootfs-etc-systemd-logind.conf
208f53c1d142151277cfcf0a95df839919ce8cb15ec888d50890dc6b3631a994335bfa12194cec856b649f97cfd7c80019c595cc0ea2c5ee96498a3e76a9950b  rootfs-etc-ssh-sshd_config.d-usepam.conf
15423bfda57c90ab62fe69865ca4072a0aeb83bf77d9c278257e346f4da81843d010b41003c91ae9f3fcb1c67447645e7c19078eea2bf11312051e6ad7523ad1  rootfs-usr-share-mkinitfs-files-01-initramfs-base-systemd.files
2595d6bfcbc49655e97ff5a882a0770fec957c414e6122ec1c0522dcd208e59d57d413b091c129ccfb2c1f4bbd84b6d2e6ef41903a2005d58d9ba8f55faf5024  rootfs-usr-lib-systemd-system-preset-90-base.preset
9b3b9abdb3d3541038d37d6870baed81f20be7f5b80874bd142eeb686b08958180b4d4a293912c9760e4353a58d6a5dea43e155002f224d14a157f7a082cde60  rootfs-usr-lib-systemd-user-preset-90-base.preset
605df1f004783d2e0ec5dd99a688bca27502c8c24bc05fb4dc26589b2070b0fbd1cf9bd56e6861d7cda2f8ac8147e7eb040acfd886185c01c8cf9de8b1ce2dcd  rootfs-usr-bin-setup-timezone
"
